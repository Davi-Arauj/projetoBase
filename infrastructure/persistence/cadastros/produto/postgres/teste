-- public.t_item definition

-- Drop table

-- DROP TABLE public.t_item;

CREATE TABLE public.t_item (
	id serial4 NOT NULL,
	data_criacao timestamp NOT NULL DEFAULT now(),
	data_atualizacao timestamp NULL,
	nome varchar(100) NULL,
	nome_fiscal varchar(255) NULL,
	categoria_id int4 NOT NULL,
	subcategoria_id int4 NOT NULL,
	fabricante_id int4 NULL,
	fabricante_modelo_id int4 NULL,
	numero_serie varchar(255) NULL,
	numero_serie_interno varchar(255) NULL,
	quantidade int4 NULL DEFAULT 1,
	localidade_id int4 NULL,
	localidade_contrato_id int4 NULL,
	descricao text NULL,
	subcategoria_estado_id int4 NULL,
	funcionario_id int4 NULL,
	lote varchar(255) NULL,
	codigo_item_old_estoque int8 NULL,
	rota varchar(50) NULL,
	fileira_prateleira_gondola_id int4 NULL,
	mac macaddr NULL,
	data_movimento timestamp NULL,
	nome_pesquisa text NULL,
	inteiro bool NULL DEFAULT true,
	CONSTRAINT t_item_mac_subctg_ukey UNIQUE (subcategoria_id, mac),
	CONSTRAINT t_item_migracao_ukey UNIQUE (codigo_item_old_estoque),
	CONSTRAINT t_item_numero_serie_interno_ukey UNIQUE (numero_serie_interno),
	CONSTRAINT t_item_numero_serie_subctg_ukey UNIQUE (numero_serie, subcategoria_id),
	CONSTRAINT t_item_pkey PRIMARY KEY (id)
);
CREATE INDEX t_item_by_nome ON public.t_item USING gin (unaccent_immutable((nome)::text) gin_trgm_ops);
CREATE INDEX t_item_by_nome_pesquisa ON public.t_item USING btree (nome_pesquisa);
CREATE INDEX t_item_by_nome_pesquisa_trgm ON public.t_item USING gin (nome_pesquisa gin_trgm_ops);
CREATE INDEX t_item_categoria_idx ON public.t_item USING btree (categoria_id);
CREATE INDEX t_item_fabricante_idx ON public.t_item USING btree (fabricante_id);
CREATE INDEX t_item_fabricante_modelo_idx ON public.t_item USING btree (fabricante_modelo_id);
CREATE INDEX t_item_funcionario_idx ON public.t_item USING btree (funcionario_id);
CREATE INDEX t_item_localidade_contrato_idx ON public.t_item USING btree (localidade_contrato_id);
CREATE INDEX t_item_localidade_fab_modelo_idx ON public.t_item USING btree (localidade_id, fabricante_modelo_id);
CREATE INDEX t_item_localidade_idx ON public.t_item USING btree (localidade_id);
CREATE INDEX t_item_lote_idx ON public.t_item USING btree (lote);
CREATE INDEX t_item_nome_idx ON public.t_item USING btree (nome);
CREATE INDEX t_item_nomefiscal_idx ON public.t_item USING btree (nome_fiscal);
CREATE INDEX t_item_numero_serie_idx ON public.t_item USING btree (numero_serie);
CREATE UNIQUE INDEX t_item_numero_serie_interno_idx ON public.t_item USING btree (numero_serie_interno);
CREATE INDEX t_item_old_estoque_idx ON public.t_item USING btree (codigo_item_old_estoque);
CREATE INDEX t_item_query_idx ON public.t_item USING btree (nome, fabricante_id, categoria_id, subcategoria_id, fabricante_modelo_id);
CREATE INDEX t_item_subcategoria_estado_idx ON public.t_item USING btree (subcategoria_estado_id);
CREATE INDEX t_item_subcategoria_idx ON public.t_item USING btree (subcategoria_id);

-- Table Triggers

create trigger t_item_setar_data_atualizacao before
update
    on
    public.t_item for each row execute procedure tf_utils_setar_data_atualizacao();


-- public.t_item foreign keys

ALTER TABLE public.t_item ADD CONSTRAINT t_item_categoria_fkey FOREIGN KEY (categoria_id) REFERENCES public.t_categoria(id);
ALTER TABLE public.t_item ADD CONSTRAINT t_item_fabricante_fkey FOREIGN KEY (fabricante_id) REFERENCES public.t_fabricante(id);
ALTER TABLE public.t_item ADD CONSTRAINT t_item_fabricante_modelo_fkey FOREIGN KEY (fabricante_modelo_id) REFERENCES public.t_fabricante_modelo(id);
ALTER TABLE public.t_item ADD CONSTRAINT t_item_funcionario_fkey FOREIGN KEY (funcionario_id) REFERENCES public.t_funcionario(id);
ALTER TABLE public.t_item ADD CONSTRAINT t_item_gondola_fkey FOREIGN KEY (fileira_prateleira_gondola_id) REFERENCES public.t_fileira_prateleira_gondola(id);
ALTER TABLE public.t_item ADD CONSTRAINT t_item_localidade_contrato_fkey FOREIGN KEY (localidade_contrato_id) REFERENCES public.t_localidade_contrato(id);
ALTER TABLE public.t_item ADD CONSTRAINT t_item_localidade_fkey FOREIGN KEY (localidade_id) REFERENCES public.t_localidade(id);
ALTER TABLE public.t_item ADD CONSTRAINT t_item_subcategoria_estado_fkey FOREIGN KEY (subcategoria_estado_id) REFERENCES public.t_subcategoria_estado(id);
ALTER TABLE public.t_item ADD CONSTRAINT t_item_subcatg_fkey FOREIGN KEY (subcategoria_id) REFERENCES public.t_subcategoria(id);